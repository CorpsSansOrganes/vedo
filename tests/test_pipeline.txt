# Test Pipeline ################################
Internal use only

# SITES ########################################
https://vedo.embl.es/
https://vedo.embl.es/docs
https://github.com/marcomusy/vedo
https://forum.image.sc/search?q=vedo%20order%3Alatest

# INSTALL ######################################
cd ~/Projects/vedo
pip install -e .
pip install nevergrad -U
pip install pyefd -U
pip install iminuit -U
pip install meshio -U
pip install morphomatics -U
pip install pygeodesic -U
pip install pygmsh -U
pip install pyacvd -U
pip install pymeshfix -U
pip install tetgen -U
pip install pyshtools -U
pip install trimesh -U

# DRY RUN ######################################
cd ~/Projects/vedo/
sed -i "s/dry_run_mode = 0/dry_run_mode = 2/g" vedo/settings.py  ### DISABLE VIZ
sed -i "s/dry_run_mode = 2/dry_run_mode = 0/g" vedo/settings.py  ### ENABLE VIZ

cd ~/Projects/vedo/tests/common && ./run_all.sh 
cd ~/Projects/vedo/examples/ &&  time ./run_all.sh  2>&1 | tee ~/Dropbox/vedo_test.txt

grep -A 1 "Error" ~/Dropbox/vedo_test.txt
grep -A 3 "Trace" ~/Dropbox/vedo_test.txt
code ~/Dropbox/vedo_test.txt   #### inspect logfile (search "Traceback", "Error") ####
# (Try normal run too with visualization to make sure all is ok.)

# EXAMPLES #####################################
cd ~/Projects/vedo/tests/issues && ./run_all.sh 

# TUTORIALS ####################################
cd ~/Projects/server/vedo-embo-course/scripts && ./run_all.sh 
cd ~/Projects/server/vedo-bias-course/scripts && ./run_all.sh 

# DOLFIN/TRIMESH ###############################
cd ~/Projects/vedo/
conda activate fenics
pip install .
cd examples/other/dolfin
./run_all.sh
conda deactivate
################
cd ~/Projects/vedo/examples/other/trimesh
./run_all.sh

# Various other ###############################
cd ~/Projects/vedo/
python ~/Dropbox/documents/Medical/RESONANCIA.py
vedo https://vedo.embl.es/examples/data/panther.stl.gz
vedo https://vedo.embl.es/examples/geo_scene.npz
vedo --convert data/290.vtk --to ply && vedo data/290.ply

# NOTEBOOKS #####################################
cd ~/Projects/vedo/examples/notebooks/
jupyter notebook > /dev/null 2>&1

#################################################
# Check on OSX and windows

# VEDO PROJECTS #################################
cd ~/Projects/server/trackviewer
    ./main_test.py
################
cd /g/sharpe/software/clone_viewer2
    ./clone_viewer3d.py
################
cd ~/Projects/rio_organoid
    python main4.py
    python piv_read_fw2_C3.py
################
cd ~/Projects/server/cell_density
   analyse_density.py test_image.png test_image_gfp.png
   edu_histogram.py test_image.png
################
cd ~/Projects/new_yalla/limb_opti_here
   python result_viz3.py
################
cd ~/Projects/server/welsh_embryo_stager
   python stager.py pics/E14.5_L3-03_HL2.5X.jpg
################
cd ~/Projects/oocytes
   python main4b.py
################
cd ~/Projects/umap_viewer3d
   python main6.py
################
cd ~/Projects/napari-vedo-bridge 
    conda activate napari-env
    python ~/Projects/vedo/examples/other/napari1.py
    napari
    conda deactivate
################
cd ~/Projects/clonal_analysis2d_splines
    python -m analysis_plots


# RELEASE #################################
cd ~/Projects/vedo

# check version and status
code vedo/version.py
git status
git commit -am 'comment'
git push

# upload to pypi
python setup.py sdist bdist_wheel
twine upload dist/vedo-?.?.?.tar.gz -r pypi

# make github release
cd ~/Projects/vedo
code docs/changes.md
code vedo/version.py  # to add .dev0
https://repology.org/project/vedo/badges


# DOCUMETATION #############################
mount_staging
cd ~/Projects/vedo/docs/pdoc
./build_html.py 

# check web page examples
cd ~/Projects/vedo/
code www/examples_db.js
code www/index.html
